
# DAREL : Hash
## Overview
The program included in this folder contains the algorithms for generating the relevant hashes for patient identifiers. It is important to note that before providing inputs to this process, some level of data cleaning and/or harmonization should be performed. Without this pre-requisite, small differences in formatting between systems will cause the collision process to fail. Recommendations for harmonization can be found at the bottom of this document. The requirements for harmonization should be defined and distributed by the lead site.

## Requirements
1) Approval from your institution to perform this linkage process
2) SAS 9.4 or above
3) Formatted data based on Harmonization Requirements

## Instructions
*Prerequisite: Data Has Gone Through Harmonization Process*
### Setup
Obtain all of the necessary files for the Hash component of DAREL by either downloading the entire repository for DAREL or by following these steps:
1) Create a folder on your computer called 'DAREl_Hash'
2) Create two empty folders under 'DAREL_Hash': in , out
3) Save the `hashMaster.sas` and `hashMacro.sas` files to the 'DAREL_Hash' folder
4) Configure the `hashMaster.sas` file based on the instructions in the **Configuration** section of this document

The `in` folder is where any input files for the Hash program should be saved. This includes the patient identifier file and a 'Hash Definitions' file if one is being used.

The `out` folder will contain all output files generated by the Hash program. This in cludes the Hash output, the HIPAA Identifier+Hash crosswalk file, and the Hash Definitions applied in the program.

The File/Folder layout for the hash prgoram should appear as:
```
./ = hash or DAREL_hash
./hashMaster.sas
./hashMacro.sas
./in/
./out/
```

### Configuration
There are a number of parameters within **DAREL : Hash** that need to be set prior to running the program. The configuration options are found in the `hashMaster.sas` file. If you downloaded the entire DAREL repository then the `hashMaster.sas` file is located under the 'hash' folder. 

`localDir`: The full path of where the *hashMaster.sas* program is located. Do not include a trailing '\' in the path definition
```%let localDir = C:\DAREL\hash ;```

`infileName`: The name of the CSV file to be loaded in. This file must be located in the `&localDir\in\` directory. Do not include the `.csv` extension in the filename.

`institution`: The name of your institution, abbreviated preferably. 

`delimiter`: The delimiter used in the provided CSV files. All CSV files must use the same delimiter.

`hashConfig`: The type of hash(es) to generate. There are 3 available options:
1. `SINGLE` 
: Produces a single hash composed of the keys specified in hashConfigDef
2. `N_PLUS_1` 
: Uses values set in "hashKeys" to dynamically creates N plus 1 hashes (N = number of hashable identifiers in the file).
		Hash 1 = Composite hash of all permissable identifiers
		Hash 2 through (n+1) = Hash of "leave one out" identifiers
3. `FILE` 
: Reads a hash definition file where any number of hashes or combinations can be defined

*See the section titled **Permissable Identifiers** for a list of currently allowed identifiers*

`hashConfigDef`: The definition of identifiers to be used in generating the hashes. Varies depending on the value for `hashConfig`.
1. If `hashConfig = SINGLE` then set hashConfigDef to the space delimited list of identifiers to be used in the hash
2. If `hashConfig = N_MINUS_1` then set hashConfigDef to a space delimited list of identifiers.
3. If `hashConfig = FILE` then set hashConfigDef to a definition file located in the `&localDir`.

*See the section titled **Permissable Identifiers** for a list of currently allowed identifiers*

`systemKey`: *Optional* A key present in the `infileName` that serves as an internal system identifier. Will not be used in hashes but will be included in the local crosswalk output file.


### Testing Setup
5 files are provided in the DAREL repository for testing purposes under the /hash/in/ and /hash/out/ paths.
1) `/in/example_hashes.csv` : Example Hash Definitions for `hashConfig = FILE`
2) `/in/pplUNCtest.csv` : Example identifier input for hashing
3) `/out/UNC_HashDefinitions_pplUNCtest.csv` : Definitions used and ID's of hashes applied in the program
4) `/out/UNC_HashOnly_pplUNCtest.csv` : The hashes generated from the data provided in pplUNCtest.csv
5) `/out/UNC_HIPAA_pplUNCtest.csv` : The crosswalk file that contains all of the patient identifiers used and the hashes corresponding to them.


## Hash Configuration
One of the capabilities of DAREL is to produce multiple hashes based on identifier input. The list fo ahshes generated can be explicitly defined via a "Hash Definition" file. If this methodology is utilized, the same definition file **MUST** be used at all participating sites.

The format of the file is as follows:

```
HASH_ID | HASH_ENTITIES
ALL | FIRST_NAME DATE_OF_BIRTH DATE_OF_SERVICE GENDER
DATES_ONLY | DATE_OF_BIRTH DATE_OF_SERVICE
MINUS_NAME | DATE_OF_BIRTH DATE_OF_SERVICE GENDER
```

**A row called *ALL* must be present and contain all of the potential identifiers provided in the input file**

The list of `HASH_ENTITIES` can be composed of any combination of the Permissable Identifiers listed further below. This list should be **space delimited**.

After execution, each site will have an a file generated that includes all of the Hash definitions used and an ID assigned to each of the Hashes. This ID is generated by the application, corresponds to the # in the `hash_value_#` and provides a specific definition of that hash. This file is generated by all `hashConfig` options but is important to have to confirm that `hash_value_3` at Site A is the entities as `hash_value_3` at Site B.

## Permissable Identifiers
<!-- Copy and paste the converted output. -->

<!-----
NEW: Check the "Suppress top comment" option to remove this info from the output.

Conversion time: 0.518 seconds.


Using this Markdown file:

1. Paste this output into your source file.
2. See the notes and action items below regarding this conversion run.
3. Check the rendered output (headings, lists, code blocks, tables) for proper
   formatting and use a linkchecker before you publish this page.

Conversion notes:

* Docs to Markdown version 1.0β29
* Wed Jul 22 2020 13:26:53 GMT-0700 (PDT)
* Source doc: Untitled document
* Tables are currently converted to HTML tables.
----->



<table>
  <tr>
   <td><strong>Identifier</strong>
   </td>
   <td><strong>Description</strong>
   </td>
   <td><strong>Character Limit</strong>
   </td>
   <td><strong>Example</strong>
   </td>
  </tr>
  <tr>
   <td>FIRST_NAME
   </td>
   <td>Patient's First Name
   </td>
   <td>10
   </td>
   <td>Alice
   </td>
  </tr>
  <tr>
   <td>LAST_NAME
   </td>
   <td>Patient's Last Name
   </td>
   <td>20
   </td>
   <td>Baumgarten
   </td>
  </tr>
  <tr>
   <td>MIDDLE_NAME
   </td>
   <td>Patient's Middle Initial
   </td>
   <td>1
   </td>
   <td>G
   </td>
  </tr>
  <tr>
   <td>GENDER
   </td>
   <td>Single character representation of the patient's gender
   </td>
   <td>1
   </td>
   <td>F
   </td>
  </tr>
  <tr>
   <td>DATE_OF_BIRTH
   </td>
   <td>Patient's Date of Birth
   </td>
   <td>10
   </td>
   <td>1957-04-12
   </td>
  </tr>
  <tr>
   <td>YEAR_OF_BIRTH
   </td>
   <td>Patient’s year of birth
   </td>
   <td>4
   </td>
   <td>1957
   </td>
  </tr>
  <tr>
   <td>MONTH_OF_BIRTH
   </td>
   <td>Patient’s month of birth
   </td>
   <td>2
   </td>
   <td>04
   </td>
  </tr>
  <tr>
   <td>DATE_OF_SERVICE
   </td>
   <td>Date which a specific event occurred
   </td>
   <td>10
   </td>
   <td>2017-08-09
   </td>
  </tr>
  <tr>
   <td>YEAR_OF_SERVICE
   </td>
   <td>Year in which a specific event occurred 
   </td>
   <td>4
   </td>
   <td>2017
   </td>
  </tr>
  <tr>
   <td>MONTH_OF_SERVICE
   </td>
   <td>Month in which a specific event occurred
   </td>
   <td>2
   </td>
   <td>08
   </td>
  </tr>
  <tr>
   <td>STREET_ADDRESS
   </td>
   <td>Patient's street address 
   </td>
   <td>50
   </td>
   <td>123 Example Rd
   </td>
  </tr>
  <tr>
   <td>ZIP_CODE
   </td>
   <td>Patient's 5 digit zipcode
   </td>
   <td>5
   </td>
   <td>27599
   </td>
  </tr>
  <tr>
   <td>SSN4
   </td>
   <td>Last 4 digits of the patient's SocialS ecurity Number
   </td>
   <td>4
   </td>
   <td>7878
   </td>
  </tr>
  <tr>
   <td>PROVIDER_ID
   </td>
   <td>A shared identifier between systems for a service or practitioner (ie DEA Number or National provider ID)
   </td>
   <td>15
   </td>
   <td>1987291827
   </td>
  </tr>
  <tr>
   <td>FIRST_NAME_FIRST3
   </td>
   <td>First 3 characters of a patient's first name
   </td>
   <td>3
   </td>
   <td>Ali
   </td>
  </tr>
  <tr>
   <td>LAST_NAME_FIRST8
   </td>
   <td>First 8 characters of a patient's last name
   </td>
   <td>8
   </td>
   <td>Baumgart
   </td>
  </tr>
  <tr>
   <td>MULTI_PURPOSE_ID
   </td>
   <td>A flexible field to put other kinds of identifiers that may be specific to your use case
   </td>
   <td>20
   </td>
   <td>Yellow
   </td>
  </tr>
</table>

## Harmonization
#### Missing Data
If data is missing from a field in any capacity, it is recommended that sites use a multi-hash approach to account for missing data. A single missing value at one site where all other identifiers match will cause a `SINGLE` hash methodology to fail to match.
#### Alpha-numeric Characters
Charatcers such as hyphens, commans, periods, apostrophes or other non A-Z characters should be removed from all string values, with the exception of dates.
> Mary-Joe becomes MaryJoe
#### Dates
Dates should be formatted as : 
> MM-DD-YYYY
Dates should not include any time, day of the week or other erroneous information
#### Middle Names 
Middle Names should be restricted the first character of the middle name. Sites should be cautious and check that patient's middle initials are not concatenated onto their first name. If this occurs, additional work needs to be done to remove the middle initial from the first name.
#### Last 4 of SSN
Checks should be performed to identify erroneous SSN such as "0000","1111","9999" and participating sites should agree to harmonize around a specific erroneous value.
